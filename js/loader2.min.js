/* SHOPINPIC.COM loader script
Sat May 9 18:51:40 MSK 2015
*/
var g_globalAreaMapOffset=0;function ShopinpicArea(a,b,d,c){var e=a.img;this.sinpImage=a;this.xScale=d;this.yScale=c;if(this.imgObj=e)this.imgOffset=null,this.data=b,this.areas=[],this.init(this.data)}ShopinpicArea.prototype.remove=function(){for(var a in this.areas)this.areas[a].parentNode.removeChild(this.areas[a]);this.areas=[]};ShopinpicArea.prototype.refresh=function(){this.remove();this.init(this.data)};
ShopinpicArea.prototype.init=function(a){this.imgOffset=this._getAbsolutePosition();this.areas=[];for(i in a)this._addArea(i,a[i])};
ShopinpicArea.prototype._getAbsolutePosition=function(a){a||(a=this.imgObj);var b=0,d=0;window.getComputedStyle&&(b=parseInt(window.getComputedStyle(a,null).getPropertyValue("padding-left")),d=parseInt(window.getComputedStyle(a,null).getPropertyValue("padding-top")));if(a.offsetParent){do b+=a.offsetLeft+a.clientLeft,d+=a.offsetTop+a.clientTop;while(a=a.offsetParent)}return{left:b,top:d}};
ShopinpicArea.prototype._addArea=function(a,b){g_globalAreaMapOffset++;var d=parseInt(this.imgObj.clientWidth);parseInt(this.imgObj.clientHeight);var c=document.createElement("div");this.areas.push(c);var e="areamap_"+g_globalAreaMapOffset;c.setAttribute("id",e);c.setAttribute("class","areamap show");parseInt(this.xScale*b.x);window.getComputedStyle&&(window.getComputedStyle(this.imgObj,null).getPropertyValue("position"),parseInt(window.getComputedStyle(this.imgObj,null).getPropertyValue("padding-left")),
parseInt(window.getComputedStyle(this.imgObj,null).getPropertyValue("padding-top")),parseInt(window.getComputedStyle(this.imgObj,null).getPropertyValue("border-left-width")),parseInt(window.getComputedStyle(this.imgObj,null).getPropertyValue("border-top-width")));e=this.sinpImage.sip.getAbsoluteData(this.imgObj);c.style.left=parseInt(e.x+b.x*this.xScale)+"px";c.style.top=parseInt(e.y+b.y*this.yScale)+"px";e=parseInt(this.xScale*b.width);c.style.width=e+"px";e=parseInt(this.yScale*b.height);c.style.height=
e+"px";c.innerHTML="";c.divId=g_globalAreaMapOffset;this.imgObj.parentNode.insertBefore(c,this.imgObj.nextSibling);c.onclick=function(){var a=document.getElementById("areamap_"+this.divId+"_popup");a.style.display=a.style.display&&"none"!=a.style.display?"none":"block"};b.placement||(b.placement="middle_center");var e=this.xScale*(parseInt(b.width)-24/this.xScale),f=this.yScale*(parseInt(b.height)-24/this.yScale);"top_left"==b.placement&&(iconTop=iconLeft=0);"top_center"==b.placement&&(iconLeft=e/
2,iconTop=0);"top_right"==b.placement&&(iconLeft=e,iconTop=0);"middle_left"==b.placement&&(iconLeft=0,iconTop=f/2);"middle_center"==b.placement&&(iconLeft=e/2,iconTop=f/2);"middle_right"==b.placement&&(iconLeft=e,iconTop=f/2);"bottom_left"==b.placement&&(iconLeft=0,iconTop=f);"bottom_center"==b.placement&&(iconLeft=e/2,iconTop=f);"bottom_right"==b.placement&&(iconLeft=e,iconTop=f);iconLeft=parseInt(iconLeft);iconTop=parseInt(iconTop);e=document.createElement("div");f="areamap_number areamap_number_"+
g_globalAreaMapOffset;b.theme||(b.theme="target");f="shopinpic_icon shopinpic_"+b.theme+" shopinpic_"+b.theme+"_"+g_globalAreaMapOffset;e.setAttribute("class",f);e.style.left=iconLeft+"px";e.style.top=iconTop+"px";c.appendChild(e);f=document.createElement("div");e="areamap_"+g_globalAreaMapOffset+"_popup";f.setAttribute("id",e);b.showOnLoad&&(f.style.display="block");var h=b.color?b.color:"biege",g="";b.visible&&(g="areamap_visible");f.setAttribute("class","areamap_popup background_theme_"+h+" "+
g);var h=parseInt(iconLeft+24+2),g=iconLeft-24+10-150,k="right",k="undefined"===typeof this.sinpImage.sip.popupPositioning?"right":this.sinpImage.sip.popupPositioning;"left"==k&&(h=g);"auto"==k&&(k=parseInt(c.style.marginLeft),k+iconLeft-2-150>d-(k+h+150)&&(h=g));f.style.left=h+"px";f.style.top=iconTop+"px";f.style.width="150px";f.innerHTML="";b.title&&(f.innerHTML+='<div class="title">'+b.title+"</div>");b.alt&&(f.innerHTML+='<div class="text">'+b.alt+"</div>");b.popupHtml&&(f.innerHTML+=b.popupHtml);
c.appendChild(f);d=parseInt(f.style.left);f.style.left="-10000px";f.style.display="block";parseInt(document.getElementById(e).clientHeight);f.style.left=d+"px";f.style.display="";f.style.opacity=""};var ShopinpicImage=function(a){this.img=a;this.areas=[];this.controlPanelDiv=this.promoDiv=this.width=this.height=this.nHeight=this.nWidth=null};ShopinpicImage.prototype.refreshPromo=function(){if(this.promoDiv){var a=this.sip.getAbsoluteData(this.img);this.promoDiv.style.left=a.x+"px";this.promoDiv.style.top=a.y+a.h-12+"px";this.promoDiv.style.width=a.w+"px"}};
ShopinpicImage.prototype.addPromo=function(){this.promoDiv=document.createElement("div");this.promoDiv.setAttribute("class","sinp_promo");this.promoDiv.innerHTML='<span>Image areas by <a href="http://shopinpic.com/" target="_blank">shopinpic.com</a><span>';this.img.parentNode.insertBefore(this.promoDiv,this.img.nextSibling);this.refreshPromo()};
ShopinpicImage.prototype.refreshControlPanel=function(){if(this.controlPanelDiv){var a=this.sip.getAbsoluteData(this.img);this.controlPanelDiv.style.width=a.w+"px";this.controlPanelDiv.style.left=a.x+"px";this.controlPanelDiv.style.top=a.y+a.h+"px"}};
ShopinpicImage.prototype.initControlPanel=function(){var a=document.createElement("ul");a.setAttribute("class","sinp_cp");a.innerHTML='<li><a href="#" onclick="window.open(\''+this.sip.baseUrl+"imgMap3/?apiKey="+this.sip.apiKey+"&url="+this.img.src+"&callback_url=', '_blank'); return false\">&nbsp;</a></li>";this.img.parentNode.insertBefore(a,this.img.nextSibling);this.controlPanelDiv=a;this.refreshControlPanel()};
ShopinpicImage.prototype.refreshAreas=function(){var a=this.img.width/this.nWidth,b=this.img.height/this.nHeight,d;for(d in this.areas)this.areas[d].xScale=a,this.areas[d].yScale=b,this.areas[d].refresh();this.refreshPromo();this.refreshControlPanel()};ShopinpicImage.prototype.initAreas=function(a){this.areas=[];a=new ShopinpicArea(this,a,this.img.width/this.nWidth,this.img.height/this.nHeight);this.areas.push(a)};var Shopinpic=function(a){var b="https:"==document.location.protocol?"https://ssl.":"http://www.",d=document.createElement("script");d.src=b+"google-analytics.com/ga.js";d.onload=function(){var a=_gat._getTracker("UA-25646694-2");a._initData();a._trackPageview()};document.body.appendChild(d);this.baseUrl="//shopinpic.com/";"undefined"!==typeof a.baseUrl&&(this.baseUrl=a.baseUrl);this.className=null;"undefined"!==typeof a.className&&(this.className=a.imgCssName);this.adminMode=a.adminMode;this.minImageWidth=
240;"undefined"!==typeof a.minImageWidth&&(this.minImageWidth=a.minImageWidth);this.minImageHeight=240;"undefined"!==typeof a.minImageHeight&&(this.minImageHeight=a.minImageHeight);this.apiKey=a.apiKey;this.popupPositioning=a.popupPositioning;this.sinpImages=[];var c=this;window.addEventListener?window.addEventListener("resize",function(a){c.onResize(a)}):window.attachEvent&&window.attachEvent("onresize",function(a){c.onResize(a)});this.init()};
document.getElementsByClassName||(document.getElementsByClassName=function(a){for(var b=[],d=this.getElementsByTagName("*"),c=0;c<d.length;c++)-1<(" "+d[c].className+" ").indexOf(" "+a+" ")&&b.push(d[c]);return b});Shopinpic.prototype.onResize=function(a){for(var b in sinp.sinpImages)this.sinpImages[b].refreshAreas()};
function getNaturalWidthHeight(a){var b={nWidth:null,nHeight:null};if(a.naturalWidth&&a.naturalHeight)b.nWidth=a.naturalWidth,b.nHeight=a.naturalHeight;else{var d=new Image;d.src=a.src;b.nWidth=d.width;b.nHeight=d.height;delete d}return b}
Shopinpic.prototype.init=function(){this.sinpImages=[];var a;a=this.className?document.getElementsByClassName(this.className):document.getElementsByTagName("img");var b=a.length;for(i=0;i<a.length;i++){var d=a[i],c=this;d.onerror=function(){b--;if(0==b)c.onInitialized()};d.onload=function(){var a=new ShopinpicImage(this);a.sip=c;var d=getNaturalWidthHeight(this);a.nWidth=d.nWidth;a.nHeight=d.nHeight;a.width=this.clientWidth;a.height=this.clientHeight;this.clientWidth>c.minImageWidth&&this.clientHeight>
c.minImageHeight&&c.sinpImages.push(a);b--;if(0==b)c.onInitialized()};if(1==d.complete)d.onload()}};Shopinpic.prototype.onInitialized=function(){var a=[],b;for(b in this.sinpImages)this.sinpImages[b].initAreas(),a.push(this.sinpImages[b].img.src);var d=this;this._getDatas(a,function(a){if(a.data)for(var b=0;b<a.data.length;b++){var f=a.data[b];d.sinpImages[f.id].addPromo();d.sinpImages[f.id].initAreas(f.areas)}});if(this.adminMode)for(b in this.sinpImages)this.sinpImages[b].initControlPanel()};
Shopinpic.prototype._getDatas=function(a,b){for(var d=this.baseUrl+"imgMap3/getDatas.php?apiKey="+this.apiKey,c="",e=0;e<a.length;e++)0<e&&(c+="&"),c+="imagesUrls[]="+a[e];if(c.length){var e=navigator.userAgent,f=99;1<e.indexOf("MSIE")&&(f=parseInt(e.substr(e.indexOf("MSIE")+5,5)));if(10>f){var h=new XDomainRequest;h&&(h.open("POST",d),h.onload=function(){var a=null;window.JSON&&window.JSON.parse?a=window.JSON.parse(h.responseText):eval("jsonObj = "+h.responseText);b(a)},h.send(c))}else{var g=this._createXMLHTTPObject();
g&&(g.open("POST",d,!0),c&&g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.onreadystatechange=function(){if(4==g.readyState&&(200==g.status||304==g.status)){var a=null;window.JSON&&window.JSON.parse?a=window.JSON.parse(g.response):eval("jsonObj = "+trim(g.response));b(a)}},4!=g.readyState&&g.send(c))}}};
Shopinpic.prototype._createXMLHTTPObject=function(){this._XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(var a=!1,b=0;b<this._XMLHttpFactories.length;b++){try{a=this._XMLHttpFactories[b]()}catch(d){continue}break}return a};
Shopinpic.prototype.getAbsoluteData=function(a){var b=0,d=0,c=0,e=0,c=a,f=0,h=0;do{var g=window.getComputedStyle(c);if("relative"!=g.getPropertyValue("position")){e=parseInt(g.getPropertyValue("padding-left"));isNaN(e)&&(e=0);var k=parseInt(g.getPropertyValue("padding-top"));isNaN(k)&&(k=0);var l=parseInt(g.getPropertyValue("border-left-width"));"thin"==l&&(l=2);"medium"==l&&(l=4);"thick"==l&&(l=6);isNaN(l)&&(l=0);g=parseInt(g.getPropertyValue("border-top-width"));"thin"==g&&(g=2);"medium"==g&&(g=
4);"thick"==g&&(g=6);isNaN(g)&&(g=0);var m=c.offsetLeft;isNaN(m)&&(m=0);var n=c.offsetTop;isNaN(n)&&(n=0);f+=e+2*l;h+=k+2*g;b+=parseInt(m)+l+e;d+=parseInt(n)+g+k}}while(c=c.offsetParent);c=b;e=d;b=Math.max(a.clientWidth,a.offsetWidth)-f;a=Math.max(a.clientHeight,a.offsetHeight)-h;return{x:c,y:e,w:b,h:a}};
Shopinpic_extendChildImages=function(a){if(a=document.getElementById(a)){a=a.getElementsByTagName("img");for(var b=0;b<a.length;b++){var d=a[b].getAttribute("class");if(!d||!d.match(/shopinpic/)){var c="shopinpic";d&&null!=d&&(c=d+" "+c);a[b].setAttribute("class",c)}}}};window.Shopinpic=Shopinpic;window.Shopinpic_extendChildImages=Shopinpic_extendChildImages;
window.getComputedStyle||(window.getComputedStyle=function(a,b){this.el=a;this.getPropertyValue=function(b){var c=/(\-([a-z]){1})/g;"float"==b&&(b="styleFloat");c.test(b)&&(b=b.replace(c,function(a,b,c){return c.toUpperCase()}));return a.currentStyle[b]?a.currentStyle[b]:null};return this});
